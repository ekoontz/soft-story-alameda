<!DOCTYPE html>
<html>
<head>
  <title>Leaflet Quick Start Guide Example</title>
  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

  <!-- STYLES -->
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
  <link rel="stylesheet" type="text/css" href="css/styles.css">

  <!-- SCRIPTS -->
  <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
  <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>

</head>
<body>
  <div id="map"></div>

  <script>

    var map = L.map('map').setView([37.765206, -122.241636], 14);

    var buildingdata;
    var latlonglookup;

    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
      attribution: 'Map data &copy <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
    }).addTo(map);

    L.marker([37.765206, -122.241636]).addTo(map)
      .bindPopup("<b>Hello world!</b><br />I am a popup.");

    var popup = L.popup();

    $.getJSON("./latlonglookup.json", function(got_latlonglookup) {
      latlonglookup = got_latlonglookup;

      $.getJSON("./alameda.json", function(got_buildingdata) {
        buildingdata = got_buildingdata;

        _.each(got_buildingdata['result']['records'], function(item){
          key = item['PermitNumber'];
          latlong = latlonglookup[key];
          console.log(item);
          L.marker(latlong).addTo(map).bindPopup(item['StreetAddress'] + '<br><br>' + item['Description']);
        });

        console.log('yolo');
      });
    });

  </script>
</body>
</html>
